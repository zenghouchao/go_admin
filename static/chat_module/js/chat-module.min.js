/**
 * Created by hucf on 2020/04/01.
 * Contact me if you have any question.
 * QQ:604712572
 */
(function(t,e){"use strict";var s=function(i){function a(){var t='<div class="cm-float-container"><div class="cm-float-content"><span class="fa fa-commenting"></span></div></div>',s='<div class="cm-chat-container"><div class="cm-chat-content"><div class="cm-chat-content-shadow"><span class="cm-chat-loading fa fa-spinner fa-spin"></span></div>';s+='<div class="cm-chat-content-left"><div class="cm-chat-list-nav"><div class="cm-chat-recent cm-chat-nav-select" data-id="chat_list"><span class="fa fa-comments-o"></span></div><div class="cm-chat-recent" data-id="group_list"><span class="fa fa-user-o"></span></div><div class="cm-chat-recent" data-id="notice_list"><span class="fa fa-bullhorn"></span></div></div>',s+='<div class="cm-chat-list-content"><ul id="cm_chat_list" class="cm-chat-ul"></ul><ul id="cm_group_list" class="cm-chat-ul" style="display: none;"></ul><ul id="cm_notice_list" class="cm-chat-ul" style="display: none;"></ul></div></div>',s+='<div class="cm-chat-content-right"><div class="cm-content-up"><div class="cm-chat-name"><span class="cm-chat-name-text"></span></div><div class="cm-chat-settings"><div class="cm-chat-setting"><div class="cm-chat-setting-holder"><span class="fa fa-plus"></span></div><div class="cm-chat-setting-holder"><span class="fa fa-cog"></span></div></div></div></div>',s+='<div class="cm-content-middle"><div class="cm-history-wrapper"><ul id="cm_history_list" class="cm-history-list"></ul></div></div>',s+='<div class="cm-content-down"><div class="cm-content-tool"><div class="cm-tool-holder"><span class="fa fa-font"></span></div><div class="cm-tool-holder"><span class="fa fa-smile-o"></span></div><div class="cm-tool-holder"><span class="fa fa-scissors"></span></div><div class="cm-tool-holder"><span class="fa fa-hand-o-right"></span></div><div class="cm-tool-holder"><span class="fa fa-microphone"></span></div><div class="cm-tool-holder"><span class="fa fa-picture-o"></span></div></div><div class="cm-content-input"><div class="cm-content-textarea" contenteditable="true"></div></div><div class="cm-send-btn"></div></div></div></div></div>',e.body.insertAdjacentHTML("beforeend",t),e.body.insertAdjacentHTML("beforeend",s)}function c(){var t=e.getElementsByClassName("cm-float-container")[0];t.addEventListener("click",n),_(t,t);for(var s=e.getElementsByClassName("cm-chat-list-nav")[0].children,i=0;i<s.length;i++)s[i].addEventListener("click",function(){this.classList.add("cm-chat-nav-select");for(var t=0;t<s.length;t++)s[t]!=this&&s[t].classList.remove("cm-chat-nav-select");var i=e.getElementById("cm_"+this.dataset.id),a=i.parentNode.children;for(t=0;t<a.length;t++)i!=a[t]&&(a[t].style.display="none");i.style.display="block"});var a=e.getElementsByClassName("cm-chat-close")[0],c=e.getElementsByClassName("cm-chat-min")[0];a.addEventListener("click",function(){b()}),c.addEventListener("click",function(){b()});var l=e.getElementsByClassName("cm-content-textarea")[0];l.addEventListener("keyup",function(t){f(t)});var d=e.getElementsByClassName("cm-send-btn")[0];d.addEventListener("click",function(){g()})}function n(){j.classList.toggle("cm-chat-content-show"),N.classList.toggle("cm-chat-show"),N.classList.contains("cm-chat-show")?(l(),o(),h(),H.style.visibility="visible",N.style.visibility="visible"):(H.style.visibility="hidden",N.style.visibility="hidden")}function l(){0==e.getElementById("cm_chat_list").children.length&&(L(),axios.get("/recent/chats").then(function(t){if(200==t.status){var s=t.data.chatList;if("object"==typeof s&&null!=s){for(var i="",a=0;a<s.length;a++){var c=C(s[a].lastTime),n=c.getHours(),l=c.getMinutes();n=n<10?"0"+n:n,l=l<10?"0"+l:l,i+='<li class="cm-chat-li" data-chat="'+s[a].chat_id+'" data-user="'+s[a].user_id+'"><div class="cm-chat-li-left"><div class="cm-chat-thumbnail"><img src="'+s[a].thumb+'"></div></div><div class="cm-chat-li-right"><div class="cm-chat-text"><div class="cm-text-name">'+s[a].name+'</div><div class="cm-text-content">'+s[a].lastMsg+'</div></div></div><div class="cm-chat-time">'+n+":"+l+"</div></li>"}e.getElementById("cm_chat_list").innerHTML=i,m(),e.getElementById("cm_chat_list").firstChild.click()}}E()}).catch(function(t){console.log(t)}))}function d(t,s,i){axios.get("/chats/details").then(function(t){if(200==t.status){var s=t.data.chatList;if("object"==typeof s&&null!=s){for(var a="",c=0;c<s.length;c++){var n=s[c].thumb,l=e.getElementsByClassName("cm-chat-header-thumbnail")[0],d=l.dataset.user;n=d==s[c].user_id?l.firstChild.getAttribute("src"):i,a+='<li class="cm-history-item"><div class="cm-history-'+(d==s[c].user_id?"myhead":"otherhead")+' cm-history-item-head"><img src="'+n+'"></div><div class="cm-history-'+(d==s[c].user_id?"mymessage":"othermessage")+' cm-history-item-message"><span>'+s[c].content+"</span></div></li>"}e.getElementById("cm_history_list").innerHTML=a}}}).catch(function(t){console.log(t)})}function m(){var t=e.getElementById("cm_chat_list").children;if("object"==typeof t&&null!=t)for(var s=0;s<t.length;s++)t[s].addEventListener("click",function(){if(!this.classList.contains("cm-chat-li-active")){for(var s=0;s<t.length;s++)t[s].classList.remove("cm-chat-li-active");this.classList.add("cm-chat-li-active")}var i=this.firstChild.firstChild.firstChild.getAttribute("src"),a=this.firstChild.nextSibling.firstChild.firstChild.innerText,c=e.getElementsByClassName("cm-chat-name-text")[0];c.innerText=a,c.dataset.user=this.dataset.user,c.dataset.chat=this.dataset.chat,c.dataset.thumb=i,d(this.dataset.chat,this.dataset.user,i)})}function o(){0==e.getElementById("cm_group_list").children.length&&axios.get("/users/groups").then(function(t){if(200==t.status){var s=t.data.groupList;if("object"==typeof s&&null!=s)for(var i="",a=0;a<s.length;a++){i+='<li class="cm-chat-gr-row" data-group="'+s[a].group_id+'"><div class="cm-chat-gr-title"><span class="fa fa-caret-right cm-chat-gr-caret"></span>&nbsp;'+s[a].group_name+'</div><ul class="cm-chat-gr-content">';var c=s[a].group_data;if("object"==typeof c&&null!=c)for(var n=0;n<c.length;n++)i+='<li class="cm-gr-content-row" data="'+c[n].user_id+'"><div class="cm-gr-content-left"><div class="cm-gr-content-thumbnail"><img src="'+c[n].thumb+'"></div></div><div class="cm-gr-content-right"><div class="cm-chat-text"><div class="cm-gr-content-name">'+c[n].user_name+'</div><div class="cm-gr-content-content">'+c[n].signature+"</div></div></div></li>";i+="</ul></li>",e.getElementById("cm_group_list").innerHTML=i,r(),e.getElementById("cm_group_list").lastChild.firstChild.click()}}})}function r(){var t=e.getElementsByClassName("cm-chat-gr-title");if("object"==typeof t&&null!=t)for(var s=0;s<t.length;s++)t[s].addEventListener("click",function(){var t=this.firstElementChild;t.classList.contains("fa-caret-right")?(t.classList.remove("fa-caret-right"),t.classList.add("fa-caret-down")):(t.classList.remove("fa-caret-down"),t.classList.add("fa-caret-right")),this.classList.toggle("cm-chat-gr-title-active")})}function h(){0==e.getElementById("cm_notice_list").children.length&&axios.get("/notices/list").then(function(t){if(200==t.status){var s=t.data.noticeList;if("object"==typeof s&&null!=s)for(var i="",a=0;a<s.length;a++){var c=C(s[a].time),n=c.getHours(),l=c.getMinutes();n=n<10?"0"+n:n,l=l<10?"0"+l:l,i+='<li class="cm-notice-li" data-notice="'+s[a].notice_id+'"><div class="cm-notice-li-left"><div class="cm-notice-thumbnail"><img src="'+D+'/img/system/notice.png"></div></div><div class="cm-notice-li-right"><div class="cm-chat-text"><div class="cm-text-name">'+s[a].notice_name+'</div><div title="'+s[a].content+'" class="cm-text-content">'+s[a].content+'</div></div></div><div class="cm-chat-time">'+n+":"+l+"</div></li>",e.getElementById("cm_notice_list").innerHTML=i,v()}}})}function v(){var t=e.getElementById("cm_notice_list").children;if("object"==typeof t&&null!=t)for(var s=0;s<t.length;s++)t[s].addEventListener("click",function(){if(!this.classList.contains("cm-notice-li-active")){for(var e=0;e<t.length;e++)t[e].classList.remove("cm-notice-li-active");this.classList.add("cm-notice-li-active")}})}function g(){var t=e.getElementsByClassName("cm-content-textarea")[0];if(""!=t.innerText.trim()){var s=e.getElementsByClassName("cm-chat-name-text")[0];if(null!=s.dataset.user){var i=e.getElementsByClassName("cm-chat-header-thumbnail")[0],a='<li class="cm-history-item"><div class="cm-history-myhead cm-history-item-head"><img src="'+i.firstChild.getAttribute("src")+'"></div><div class="cm-history-mymessage cm-history-item-message"><span>'+t.innerText+"</span></div></li>";t.innerText="",t.innerHTML="",A.insertAdjacentHTML("beforeend",a),p(),setTimeout(function(){var t=e.getElementsByClassName("cm-chat-name-text")[0];u({msg:Mock.mock("@csentence"),thumb:t.dataset.thumb})},666)}else console.log("no target")}}function u(t){var e='<li class="cm-history-item"><div class="cm-history-otherhead cm-history-item-head"><img src="'+t.thumb+'"></div><div class="cm-history-othermessage cm-history-item-message"><span>'+t.msg+"</span></div></li>";A.insertAdjacentHTML("beforeend",e),p()}function f(e){e||(e=t.event),13==(e.keyCode||e.which)&&(g(),e.srcElement.innerHTML="")}function p(){var t=e.getElementsByClassName("cm-history-wrapper")[0];A.clientHeight>t.clientHeight&&(t.scrollTop=A.clientHeight-t.clientHeight)}function y(){Mock.mock("/users/me",{userInfo:{user_id:4,name:"@cname",thumb:D+"/img/head/head4.png"}});var t=[D+"/img/head/head1.png",D+"/img/head/head2.png",D+"/img/head/head3.png",D+"/img/head/head4.png",D+"/img/head/head5.png",D+"/img/head/head6.png",D+"/img/head/head7.png",D+"/img/head/head8.png",D+"/img/head/head9.png"];Mock.mock("/recent/chats",{"chatList|10":[{"chat_id|+1":1,"user_id|+1":1,name:"@cname","thumb|1":t,lastTime:"@now",lastMsg:"@csentence(5, 15)"}]}),Mock.mock("/chats/details",{"chatList|3":[{"msg_id|+1":1,"user_id|1-9":1,name:"@cname","thumb|1":t,time:"@now",content:"@csentence(5, 15)"}]}),Mock.mock("/users/groups",{groupList:[{group_id:1,group_name:"我的好友(2/2)",group_data:[{user_id:1,user_name:"小学生",thumb:D+"/img/head/head1.png",signature:"酸酸甜甜就是我"},{user_id:2,user_name:"中学生",thumb:D+"/img/head/head2.png",signature:"很个性，没签名"},{user_id:3,user_name:"大学生",thumb:D+"/img/head/head3.png",signature:"逃课一时爽"}]},{group_id:2,group_name:"我的损友(1/2)",group_data:[{user_id:1,user_name:"王二麻子",thumb:D+"/img/head/head1.png",signature:"村口集合水泥自带"},{user_id:2,user_name:"尼古拉斯赵四",thumb:D+"/img/head/head2.png",signature:"要打去练舞室打"},{user_id:3,user_name:"菊花侠",thumb:D+"/img/head/head3.png",signature:"我打不过桃花怪"}]},{group_id:3,group_name:"我的关注(0/2)",group_data:[{user_id:1,user_name:"张全蛋",thumb:D+"/img/head/head1.png",signature:"信不信我给你一锤子"},{user_id:2,user_name:"赵铁柱",thumb:D+"/img/head/head2.png",signature:"隔壁班的张小花"}]}]}),Mock.mock("/notices/list",{noticeList:[{notice_id:1,notice_name:"系统公告",time:"@now",content:"各部门注意，6点准时下班"},{notice_id:2,notice_name:"开除通知",time:"@now",content:"系统检测到你上班摸鱼，明天不用来了"}]})}function _(s,i){function a(s){s=s||t.event;0==s.button&&(T=s.clientX,k=s.clientY,e.addEventListener("mousemove",c),e.addEventListener("mouseup",n),void 0!==i.setCapture&&i.setCapture())}function c(e){e=e||t.event;l=m.right-i.offsetWidth,d=m.bottom-i.offsetHeight;var s=e.clientX-T,a=e.clientY-k;l-=s,i.style.right=l+"px",d-=a,i.style.bottom=d+"px"}function n(){e.removeEventListener("mousemove",c),e.removeEventListener("mouseup",n),m.right=l+i.offsetWidth,m.bottom=d+i.offsetHeight,void 0!==i.releaseCapture&&i.releaseCapture()}var l,d;s.addEventListener("mousedown",a);var m=x(e,i)}function b(){j.classList.toggle("cm-chat-content-show"),N.classList.toggle("cm-chat-show"),H.style.visibility="hidden",N.style.visibility="hidden"}function L(){I.style.display="flex"}function E(){setTimeout(function(){I.style.display="none"},520)}function x(t,s){for(var i={left:-s.clientLeft,top:-s.clientTop},a=s;a!=t&&a!=e;)i.left=i.left+a.offsetLeft+a.clientLeft,i.top=i.top+a.offsetTop+a.clientTop,a=a.parentNode;return isNaN(t.scrollLeft)?(i.right=e.documentElement.scrollWidth-i.left,i.bottom=e.documentElement.scrollHeight-i.top):(i.right=t.scrollWidth-i.left,i.bottom=t.scrollHeight-i.top),i}function C(t){if(t){var e=t.split(" "),s=(e[0].split("-"),new Date(Date.parse(t)));return s}}function B(){var t=!0;return i instanceof Object?z=w({},W,i):t=!1,t}function w(){var t=arguments.length,e=arguments[0]||{};"object"!=typeof e&&"function"!=typeof e&&(e={}),1==t&&(e=this,s--);for(var s=1;s<t;s++){var i=arguments[s];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}function M(){var t="/js/chat-module.min.js",s=e.getElementsByTagName("script");if(s.length>0)for(var i=0;i<s.length;i++)if(-1!=s[i].src.indexOf(t)){D=s[i].src.substring(0,s[i].src.indexOf(t));break}if(""!=D){var a=e.createElement("link");a.href=D+"/css/chat-module.min.css",a.rel="stylesheet",a.type="text/css",e.head.appendChild(a),a=e.createElement("link"),a.href=D+"/fontawesome/css/font-awesome.min.css",a.rel="stylesheet",a.type="text/css",e.head.appendChild(a)}}if(!(this instanceof s))return new s(i);var T,k,N,H,j,I,A,O=this,W={mock_mode:!1,margin_screen_x:"30px",margin_screen_y:"30px"},z=W,D="";return O._init=function(){M(),B()&&(z.mock_mode&&y(),a(),I=e.getElementsByClassName("cm-chat-content-shadow")[0],N=e.getElementsByClassName("cm-chat-container")[0],j=e.getElementsByClassName("cm-chat-content")[0],A=e.getElementsByClassName("cm-history-list")[0],axios.get("/users/me").then(function(t){if(200==t.status){var s=t.data.userInfo,i='<div class="cm-chat-header"><div class="cm-chat-header-left"><div class="cm-chat-thumbnail-box">';i+='<div class="cm-chat-header-thumbnail" data-user="'+s.user_id+'">',i+='<img src="'+s.thumb+'"></div></div></div>',i+='<div class="cm-chat-header-middle"><div class="cm-chat-middle-box"><input type="text" placeholder="好友搜索" /><span class="fa fa-search cm-chat-search-icon"></span></div></div>',i+='<div class="cm-chat-header-right"><div class="cm-chat-header-ope cm-chat-close"><div class="cm-chat-rotate45"><span class="cm-chat-header-close"></span></div><div class="cm-chat-rotate135"><span class="cm-chat-header-close"></span></div></div><div class="cm-chat-header-ope cm-chat-max"><span class="cm-chat-header-maximize"></span></div><div class="cm-chat-header-ope cm-chat-min"><div class="cm-chat-rotate90"><span class="cm-chat-header-minimize">|</span></div></div></div></div>',N.insertAdjacentHTML("afterbegin",i),H=e.getElementsByClassName("cm-chat-header")[0]}c(),N.style.display="block",e.getElementsByClassName("cm-float-content")[0].insertAdjacentHTML("beforeend",'<div class="cm-float-number"><span style="padding-bottom: 2px;">1</span></div>'),e.getElementsByClassName("cm-send-btn")[0].insertAdjacentHTML("beforeend","<span>发送(S)</span>")}))},O._show=function(){N.classList.add("cm-chat-show"),j.classList.add("cm-chat-content-show"),N.style.visibility="visible",H.style.visibility="visible"},O._hide=function(){N.classList.remove("cm-chat-show"),j.classList.remove("cm-chat-content-show"),N.style.visibility="hidden",H.style.visibility="hidden"},O._sendMsg=function(){var t=e.getElementsByClassName("cm-content-textarea")[0];if(""!=t.innerText.trim()){var s=e.getElementsByClassName("cm-chat-header-thumbnail")[0],i='<li class="cm-history-item"><div class="cm-history-myhead cm-history-item-head"><img src="'+s.firstChild.getAttribute("src")+'"></div><div class="cm-history-mymessage cm-history-item-message"><span>'+t.innerText+"</span></div></li>";t.innerText="",t.innerHTML="",A.insertAdjacentHTML("beforeend",i),p()}},O._receiveMsg=function(t){var e='<li class="cm-history-item"><div class="cm-history-otherhead cm-history-item-head"><img src="'+t.thumb_url+'"></div><div class="cm-history-othermessage cm-history-item-message"><span>'+t.content+"</span></div></li>";A.insertAdjacentHTML("beforeend",e),p()},O._init(),{show:O._show,hide:O._hide,sendMsg:O._sendMsg,receiveMsg:O._receiveMsg}};t.ChatModule=s})(window,document);